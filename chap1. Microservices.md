# 1. 마이크로서비스 

## 1.1 마이크로서비스란?

> 작고 자율적으로 협업하는 서비스.

### 1.1.1 작고, 한 가지 일을 잘하는데 주력

명확하고 모듈화된 monolithic code base를 추구하더라도, 버그를 고치거나 어려운 구현을 하는 과정에서 연관된 코드가 곳곳으로 빠져나가곤 한다. Robert. C. Martin 은 `단일 책임 원칙`에서 "같은 이유로 변경되는 것들은 한데 모으고, 서로 다른 이유로 변경되는것들은 분리하라"고 했다.

그럼, `얼마나 작아야 작은것인가?`
- 2주 안에 재작성 될 수 있는것
- 충분히 작아서 더 이상 작아질 수 없는 크기
- etc ...

서비스가 작아질수록 마이크로서비스 아키텍쳐의 혜택과 단점(???)은 더 극대화되며, 서비스를 작게 만들면 만들수록 상호의존성에 의한 문제는 줄어든다.

### 1.1.2 자율성

마이크로서비스는 분리된 개체다. 이 서비스들은 서로 독립적으로 변겨될 수 있어야 하고, consumer를 변경할 필요 없이 독립적으로 배포될 수 있어야 한다.

> ∴ 결합(Coupling)을 없애고, 서비스를 잘 분리하도록 API를 만들자.


## 1.2 주요 혜택

- 기술 이기종성(heterogeneity) : 최소한의 공통점만을 가진 표준화된, 각 작업에 적합한 도구를 선택하게 해준다.
- 회복성 : 벽을 세워 서비스의 전체 장애를 차단하고 나머지 시스템을 계속 작동시킬 수 있게 한다. 
- 확장성 : 필요한 서비스만 확장할 수 있다. 예로, AWS의 On-demand provisioning system을 도입하면 주문형 확장 기술을 사용할 수 있다.
- 배포 용이성 : 하나의 서비스만 변경할 수 있고, 나머지 시스템과 독립적으로 배포할 수 있다. 
- 조직 부합성 : 더 작은 팀이 더 작은 코드베이스로 일할때 생산적이다. 
- 조합성 : 기능을 재사용할 기회가 많아진다. (ex. native app -> webApp / mobile / tablet / wearble)
- 대체 가능성을 위한 최적화 : 비슷한 크기로 이루어지므로 서비스를 재작성하거나 삭제하기 쉽다. 


## 1.3 서비스 지향 아키텍처(SOA)란?

> 서비스의 최종 능력 집합(End Set of Capabilities)을 제공하는 여러 서비스가 협업하도록 하는 설계 접근 방식

- 여기서 서비스란 완전히 분리된 운영시스템의 process를 의미
- 서비스 간 통신은 네트워크 호출로 이루어짐
- 소프트웨어의 재사용성 장려를 목표로 함

SOA앞에 있는 많은 문제들이 SOA의 목표를 약화시키고 말았으며, 정확한 이해와 설명이 부족하다보니 SOA 관련된 많은 위험이 발생한다. 마이크로서비스는 SOA에 대한 특정 접근법으로 보아야 한다.

## 1.4 기타 분해 기술

### 1.4.1 공유 라이브러리
거의 모든 언어가 코드베이스를 여러 라이브러리로 나누는것을 지원한다. 라이브러리(유용한 Utility모음, 재사용 가능한 정적 라이브러리)는 팀과 서비스간에 기능을 공유하도록 한다.

But 단점도 존재한다.

1. 진정한 기술 이기종성(heterogeneity)을 잃게 된다.
2. 시스템 일부를 독립적으로 확장하기 어려워진다.
3. 동적 라이브러리를 사용하지 않는 한 전체 프로세스를 재배포하지 않고선 새 라이브러리를 배포할 수 없어, 변경부분만 격리하여 배포할 수 있는 능력이 떨어진다.
4. 시스템 회복력을 보장하는 구조적 안전조치를 취할 명확한 접합부가 부족하다. 

공통 코드를 재사용하기 위해 라이브러리를 사용해야 하지만, 항상 그런것은 아니다.

### 1.4.2 모듈

얼랭에서는 모듈이 언어 런타임으로 생성된다. 따라서 얼랭 모듈은 이슈 없이도 멈추거나, 재시작하거나, 업그레이드될수 있다. 그러나 새로운 기술 적용이나 독립적인 확장 방법에 엄격한 제약을 받는다. 과도하게 결합될 수 있으며, 구조적 안전 조치를 위한 접합부(벽)이 부족할 수 있다. 

구조화가 잘 이루어진 독립형 모듈을 생성할 수 있어야 하지만, 그런 사례는 찾아보기 어렵다. 모듈 분리 약속이 실질적으로 거의 이행되지 않는다는 점.. 

### 1.5 은총알(Silver Bullet)은 없다.

마이크로서비스는 공짜도, 은총알도, 황금망치도 아니다! 
